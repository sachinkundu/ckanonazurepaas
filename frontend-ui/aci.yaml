---
apiVersion: 2019-12-01
location: westeurope
name: ckan
properties:
  containers:

    - name: ckan
      properties:
        environmentVariables:
          - name: 'CKAN_SQLALCHEMY_URL'
            value: 'postgresql://ckan_default@whockandb:<<PASSWORD>>@whockandb.postgres.database.azure.com/ckan_default'
          - name: 'CKAN_SOLR_URL'
            value: 'https://solr123.azurewebsites.net/solr/ckan/'
          - name: 'CKAN_SOLR_USER'
            value: 'solr'
          - name: 'CKAN_SOLR_PASSWORD'
            value: 'PASSWORD'
          - name: 'CKAN_REDIS_URL'
            value: 'redis://localhost:6379/1'
          - name: 'POSTGRES_PASSWORD'
            secureValue: 'PASSWORD'
          - name: 'CKAN_POSTGRES_USER'
            value: 'ckan_default'
          - name: 'CKAN_POSTGRES_HOST'
            value: 'whockandb.postgres.database.azure.com'
          - name: 'CKAN_DATAPUSHER_URL'
            value: 'http://datapusher:8800'
          - name: 'CKAN_SITE_URL'
            value: 'https://blah.blah'
        image: srhddeuwacr.azurecr.io/ckan:4514
        resources:
          requests:
            cpu: 2
            memoryInGb: 4
        ports:
          - port: 80

    - name: redis
      properties:
        image: redis:latest
        resources:
          requests:
            cpu: 1
            memoryInGb: 1.5
        ports:
          - port: 6379

    - name: datapusher
      properties:
        image: clementmouchet/datapusher
        resources:
          requests:
            cpu: 1
            memoryInGb: 1.5
        ports:
          - port: 8800

  osType: Linux
  restartPolicy: Never
  ipAddress:
    type: Public
    ports:
      - protocol: tcp
        port: 80
tags: {exampleTag: ckan}
type: Microsoft.ContainerInstance/containerGroups
